<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <button id="connectWallet">connect wallet</button>
    <p id="userWallet">address</p>

    <script>
      if (window.ethereum) {
        handleEthereum();
      } else {
        window.addEventListener("ethereum#initialized", handleEthereum, {
          once: true,
        });

        // If the event is not dispatched by the end of the timeout,
        // the user probably doesn't have MetaMask installed.
        setTimeout(handleEthereum, 3000); // 3 seconds
      }

      function handleEthereum() {
        const { ethereum } = window;
        if (ethereum && ethereum.isMetaMask) {
          console.log("Ethereum successfully detected!");
          // Access the decentralized web!
        } else {
          console.log("Please install MetaMask!");
        }
      }

      window.userWalletAdress = null;
      const connectButton = document.getElementById("connectWallet");
      const userwallet = document.getElementById("userWallet");

      function toggleButton() {
        if (!window.ethereum) {
          connectButton.innerText = "MetaMask is not installed";

          return false;
        }

        connectButton.addEventListener("click", LoginWithMetaMask);
      }

      async function LoginWithMetaMask() {
        const accounts = await window.ethereum
          .request({
            method: "eth_requestAccounts",
          })
          .catch((e) => {
            console.log(e.message);
            return;
          });

        if (!accounts) {
          return;
        } // logged in
        window.userWalletAdress = accounts[0];
        connectButton.innerText = "Account connected";
        connectButton.disabled = true;
        userwallet.innerText = window.userWalletAdress;
        console.log("address = " + userWalletAdress);

        /* connectButton.removeEventListener("click", LoginWithMetaMask); */
        /* connectButton.addEventListener("click", signoutMetaMask); */
      }

      /* function signoutMetaMask() {
        window.userWalletAdress = null;
        userwallet.innerText = "";
        connectButton.innerText = "Sign out of MetaMask";
        connectButton.addEventListener("click", LoginWithMetaMask);
      } */

      window.addEventListener("DOMContentLoaded", (event) => {
        console.log("dom loaded");
        toggleButton();
      });
    </script>
  </body>
</html>
